<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>创世块 · SimpleChain开发文档</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="创世区块作为第零个区块，其他区块直接或间接引用到创世区块。"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="创世块 · SimpleChain开发文档"/><meta property="og:type" content="website"/><meta property="og:url" content="https://simplechain.github.io/sipc-docs/"/><meta property="og:description" content="创世区块作为第零个区块，其他区块直接或间接引用到创世区块。"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/sipc-docs/"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/sipc-docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/sipc-docs/css/main.css"/><script src="/sipc-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/sipc-docs/"><h2 class="headerTitle">SimpleChain开发文档</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_1" target="_self">文档</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_10" target="_self">API</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_70" target="_self">FAQ</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_71" target="_self">在线技术支持</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>基础数据结构</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">快速了解</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_1">概述</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_2">快速开始</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_3">搭建节点</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">基础数据结构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_4">配置</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/sipc-docs/docs/docs_5">创世块</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_6">账户</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_7">交易</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_8">区块</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_9">交易回执</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">挖矿核心</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">交易池</h4><ul><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_10">架构设计</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_11">交易存储</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_12">交易入队列</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_13">内存限制</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">挖矿</h4><ul><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_14">架构</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_15">启动挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_16">挖矿流程</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">共识算法</h4><ul><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_17">共识算法</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_18">算法实现</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">底层核心技术</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_31">智能合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_33">合约模版</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_34">合约开发和部署</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">智能合约</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_35">虚拟机</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_36">运行机制</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_37">异常处理</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">SDK</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_41">Sipc API</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_42">跨链 API</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_43">SDKS</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">区块链浏览器</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_59">区块链浏览器</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_60">搭建测试链</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">矿池对接</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_61">Sipc挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_62">GPU挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_63">矿池接入</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端下载</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_64">Sipc全节点钱包</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_65">SimPool</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_66">SIPC</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_67">ChainBox</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">落地方案</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_68">落地案例1</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_69">落地案例2</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_70">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">技术支持</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_71">在线技术支持</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">创世块</h1></header><article><div><span><p>创世区块作为第零个区块，其他区块直接或间接引用到创世区块。
因此节点启动之初必须载入正确的创世区块信息，且不得任意修改。</p>
<p>以太坊允许通过创世配置文件来初始化创世区块，也可使用选择使用内置的多个网络环境的创世配置。
默认使用以太坊主网创世配置。</p>
<h2><a class="anchor" aria-hidden="true" id="创世配置文件"></a><a href="#创世配置文件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创世配置文件</h2>
<p>如果你需要搭建以太坊私有链，那么了解创世配置是必须的，否则你大可不关心创世配置。
下面是一份 JSON 格式的创世配置示例：</p>
<pre><code class="hljs css language-json">{
    <span class="hljs-attr">"config"</span>: {
        <span class="hljs-attr">"chainId"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"homesteadBlock"</span>: <span class="hljs-number">1150000</span>,
        <span class="hljs-attr">"daoForkBlock"</span>: <span class="hljs-number">1920000</span>,
        <span class="hljs-attr">"daoForkSupport"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"eip150Block"</span>: <span class="hljs-number">2463000</span>,
        <span class="hljs-attr">"eip150Hash"</span>: <span class="hljs-string">"0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0"</span>,
        <span class="hljs-attr">"eip155Block"</span>: <span class="hljs-number">2675000</span>,
        <span class="hljs-attr">"eip158Block"</span>: <span class="hljs-number">2675000</span>,
        <span class="hljs-attr">"byzantiumBlock"</span>: <span class="hljs-number">4370000</span>,
        <span class="hljs-attr">"constantinopleBlock"</span>: <span class="hljs-number">7280000</span>,
        <span class="hljs-attr">"petersburgBlock"</span>: <span class="hljs-number">7280000</span>,
        <span class="hljs-attr">"ethash"</span>: {}
    },
    <span class="hljs-attr">"nonce"</span>: <span class="hljs-string">"0x42"</span>,
    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"0x0"</span>,
    <span class="hljs-attr">"extraData"</span>: <span class="hljs-string">"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"</span>,
    <span class="hljs-attr">"gasLimit"</span>: <span class="hljs-string">"0x1388"</span>,
    <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"0x400000000"</span>,
    <span class="hljs-attr">"mixHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
    <span class="hljs-attr">"coinbase"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000"</span>,
    <span class="hljs-attr">"number"</span>: <span class="hljs-string">"0x0"</span>,
    <span class="hljs-attr">"gasUsed"</span>: <span class="hljs-string">"0x0"</span>,
    <span class="hljs-attr">"parentHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
    <span class="hljs-attr">"alloc"</span>: {
        <span class="hljs-attr">"000d836201318ec6899a67540690382780743280"</span>: {
            <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0xad78ebc5ac6200000"</span>
        },
        <span class="hljs-attr">"001762430ea9c3a26e5749afdb70da5f78ddbb8c"</span>: {
            <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0xad78ebc5ac6200000"</span>
        }
    }
}
</code></pre>
<p>根据配置用途可分为三大类：</p>
<ol>
<li>链配置
<br><code>config</code>项是定义链配置，会影响共识协议，虽然链配置对创世影响不大，但新区块的出块规则均依赖链配置。
关于链配置更多细节，请查看文章《[链参数配置]({{&lt; ref &quot;./config.md&quot; &gt;}})》。</li>
<li>创世区块头信息配置
<ul>
<li><code>nonce</code>：随机数，对应创世区块 <code>Nonce</code> 字段。</li>
<li><code>timestamp</code>：UTC时间戳，对应创世区块 <code>Time</code>字段。</li>
<li><code>extraData</code>：额外数据，对应创世区块 <code>Extra</code> 字段。</li>
<li><code>gasLimit</code>：<strong>必填</strong>，燃料上限，对应创世区块 <code>GasLimit</code> 字段。</li>
<li><code>difficulty</code>：<strong>必填</strong>，难度系数，对应创世区块 <code>Difficulty</code> 字段。搭建私有链时，需要根据情况选择合适的难度值，以便调整出块。</li>
<li><code>mixHash</code>：一个哈希值，对应创世区块的<code>MixDigest</code>字段。和 nonce 值一起证明在区块上已经进行了足够的计算。</li>
<li><code>coinbase</code>：一个地址，对应创世区块的<code>Coinbase</code>字段。</li>
</ul></li>
<li>初始账户资产配置
<br><code>alloc</code> 项是创世中初始账户资产配置。在生成创世区块时，将此数据集中的账户资产写入区块中，相当于预挖矿。
这对开发测试和私有链非常好用，不需要挖矿就可以直接为任意多个账户分配资产。</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="自定义创世"></a><a href="#自定义创世" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义创世</h3>
<p>如果你计划部署以太坊私有网络或者一个独立的测试环境，那么需要自定义创世，并初始化它。为了统一沟通，推荐先在用户根目录创建一个文件夹 <code>deepeth</code>，以做为《以太坊设计与实现》电子书学习工作目录。</p>
<pre><code class="hljs css language-bash">mkdir <span class="hljs-variable">$HOME</span>/deepeth &amp;&amp; <span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/deepeth
</code></pre>
<p>再准备两个以太坊账户，以便在创世时存入资产。</p>
<pre><code class="hljs css language-bash">dgeth --datadir <span class="hljs-variable">$HOME</span>/deepeth account new
</code></pre>
<blockquote>
<p><strong>注意</strong>：命令中的 <code>dgeth</code> 是 <code>geth</code> 程序的重命名，下同。
具体见文章《[开篇]({{&lt; ref &quot;first.md&quot; &gt;}})》。</p>
</blockquote>
<p>因为是学习使用，推荐使用统一密码 <code>foobar</code>，
执行两次命令，创建好两个账户。
这里使用 <code>--datadir</code> 参数指定以太坊运行时数据存放目录，是让大家将数据统一存放在一个本课程学习文件夹中。</p>
<p>再将下面配置内容保存到 <code>$HOME/deepeth/genesis.json</code> 文件，其中 <code>alloc</code> 项替换成刚刚创建的两个以太坊账户地址。</p>
<pre><code class="hljs css language-json">{
    <span class="hljs-attr">"config"</span>: {
        <span class="hljs-attr">"chainId"</span>: <span class="hljs-number">8888</span>,
        <span class="hljs-attr">"homesteadBlock"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"daoForkBlock"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"daoForkSupport"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"eip150Block"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"eip155Block"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"eip158Block"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"byzantiumBlock"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"constantinopleBlock"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"petersburgBlock"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"ethash"</span>: {}
    },
    <span class="hljs-attr">"nonce"</span>: <span class="hljs-string">"0x42"</span>,
    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"0x0"</span>,
    <span class="hljs-attr">"extraData"</span>: <span class="hljs-string">"0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa"</span>,
    <span class="hljs-attr">"gasLimit"</span>: <span class="hljs-string">"0x1388"</span>,
    <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"0x1"</span>,
    <span class="hljs-attr">"alloc"</span>: {
        <span class="hljs-attr">"093f59f1d91017d30d8c2caa78feb5beb0d2cfaf"</span>: {
            <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0xffffffffffffffff"</span>
        },
        <span class="hljs-attr">"ddf7202cbe0aaed1c2d5c4ef05e386501a054406"</span>: {
            <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0xffffffffffffffff"</span>
        }
    }
}
</code></pre>
<p>然后，执行 geth 子命令 init 初始化创世区块。</p>
<pre><code class="hljs css language-bash">dgeth  --datadir <span class="hljs-variable">$HOME</span>/deepeth init genesis.json
</code></pre>
<p>执行成功后，便可启动该私有链：</p>
<pre><code class="hljs css language-bash">dgeth --maxpeers 0 --datadir <span class="hljs-variable">$HOME</span>/deepeth  console
</code></pre>
<p>执行如下命令，可以查看到前面创建的两个账户，均已有资产：</p>
<pre><code class="hljs css language-js">eth.getBalance(eth.accounts[<span class="hljs-number">0</span>])
<span class="hljs-comment">// 18446744073709551615</span>
eth.getBalance(eth.accounts[<span class="hljs-number">1</span>])
<span class="hljs-comment">// 18446744073709551615</span>
</code></pre>
<p>至此，我们已完成创世定制版。</p>
<h3><a class="anchor" aria-hidden="true" id="内置的创世配置"></a><a href="#内置的创世配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内置的创世配置</h3>
<p>上面我已完成自定义创世，但以太坊作为去中心平台，需要许多节点一起参与。
仅仅为了测试，多个节点来搭建私有链比较麻烦。
如果希望和别人一起联调，或者需要在测试网络中测试DAPP时，该怎么办呢？
那么，可使用以太坊测试网络。以太坊公开的测试网络有 5 个，目前仍在运行的有 4 个，具体见下表格。</p>
<p>|测试网|共识机制|出块间隔|提供方|上线时间|备注|状态|
|---|---|---|---|---|---|---|---|
| Morden | PoW || 以太坊官方 |2015.7|因难度炸弹被迫退役 |stopped|
|<a href="https://ropsten.etherscan.io">Ropsten</a> |PoW |30秒|以太坊官方|2016.11|接替Morden| running|
|<a href="https://kovan.etherscan.io/">Kovan</a> | PoA | 4秒|以太坊钱包<br>Parity开发团队| 2017.3 |不支持geth| running |
|<a href="https://rinkeby.etherscan.io/">Rinkeby</a> | PoA |15秒| 以太坊官方| 2017.4|最常用，只支持geth | running|
|<a href="https://sokol-explorer.poa.network/">Sokol</a> | PoA |5秒| 以太坊官方POA.network团队| 2017.12|不支持geth | running|
|<a href="https://goerli.net/">Görli</a> | PoA | 15秒| 以太坊柏林社区 | 2018.9| 首个以太坊2.0实验场| running|</p>
<p>支持 geth 的3个测试网络的创世配置已内置在以太坊代码中，具体见 <code>core/genesis.go</code> 文件：</p>
<pre><code class="hljs css language-go"><span class="hljs-comment">// DefaultTestnetGenesisBlock returns the Ropsten network genesis block.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DefaultTestnetGenesisBlock</span><span class="hljs-params">()</span> *<span class="hljs-title">Genesis</span></span>{}
<span class="hljs-comment">// DefaultRinkebyGenesisBlock returns the Rinkeby network genesis block.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DefaultRinkebyGenesisBlock</span><span class="hljs-params">()</span> *<span class="hljs-title">Genesis</span></span>
<span class="hljs-comment">// DefaultGoerliGenesisBlock returns the Görli network genesis block.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DefaultGoerliGenesisBlock</span><span class="hljs-params">()</span> *<span class="hljs-title">Genesis</span></span>{}
</code></pre>
<p>当然不会缺以太坊主网创世配置，也是 geth 运行的默认配置。</p>
<pre><code class="hljs css language-go"><span class="hljs-comment">// DefaultGenesisBlock returns the Ethereum main net genesis block.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DefaultGenesisBlock</span><span class="hljs-params">()</span> *<span class="hljs-title">Genesis</span></span>{}
</code></pre>
<p>如果你不想自定义创世配置文件用于开发测试，那么以太坊也提供一份专用于本地开发的配置。</p>
<pre><code class="hljs css language-go">
<span class="hljs-comment">// DeveloperGenesisBlock returns the 'geth --dev' genesis block. Note, this must</span>
<span class="hljs-comment">// be seeded with the</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DeveloperGenesisBlock</span><span class="hljs-params">(period <span class="hljs-keyword">uint64</span>, faucet common.Address)</span> *<span class="hljs-title">Genesis</span></span>
</code></pre>
<p>运行 <code>dgeth --dev console</code> 可临时运行使用。但如果需要长期使用此模式，则需要指定 <code>datadir</code>。</p>
<pre><code class="hljs css language-bash">dgeth --dev --datadir <span class="hljs-variable">$HOME</span>/deepeth/dev console
</code></pre>
<p>首次运行 dev 模式会自动创建一个空密码的账户，并开启挖矿。
当有新交易时，将立刻打包出块。</p>
<h2><a class="anchor" aria-hidden="true" id="geth-创世区块加载流程"></a><a href="#geth-创世区块加载流程" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>geth 创世区块加载流程</h2>
<p>在运行 geth 时需根据配置文件加载创世配置以及创世区块，并校验其合法性。
如果配置信息随意变更，易引起共识校验不通过等问题。
只有在加载并检查通过时，才能继续运行程序。</p>
<p><img src="https://img.learnblockchain.cn/2019/04/07_20190407101509.png!de?width=400px" alt="创世加载流程"></p>
<p>上图是一个简要流程，下面分别讲解“加载创世配置”和“安装创世区块”两个子流程。</p>
<h3><a class="anchor" aria-hidden="true" id="加载创世配置"></a><a href="#加载创世配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加载创世配置</h3>
<p>应使用哪种创世配置，由用户在启动 geth 时决定。下图是创世配置选择流程图：
<img src="https://img.learnblockchain.cn/2019/04/07_WX20190407-103229@2x.png!de" alt="以太坊创世配置选择流程图">
通过 geth 命令参数可选择不同网络配置，可以通过 <code>networkid</code> 选择，也可使用网络名称启用。</p>
<ol>
<li><p>使用 networkid:</p>
<p>不同网络使用不同ID标识。</p>
<ul>
<li>1=Frontier，主网环境，是默认选项。</li>
<li>2=Morden 测试网络，但已禁用。</li>
<li>3=Ropsten 测试网络。</li>
<li>4=Rinkeby 测试网络。</li>
</ul></li>
<li><p>直接使用网络名称：</p>
<ul>
<li>testnet: Ropsten 测试网络。</li>
<li>rinkeby: Rinkeby 测试网络。</li>
<li>goerli: Görli 测试网络。</li>
<li>dev: 本地开发环境。</li>
</ul></li>
</ol>
<p>geth 启动时根据不同参数选择加载不同网络配置，并对应不同网络环境。
如果不做任何选择，虽然在此不会做出选择，但在后面流程中会默认使用主网配置。</p>
<h3><a class="anchor" aria-hidden="true" id="安装创世区块"></a><a href="#安装创世区块" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装创世区块</h3>
<p>上面已初步选择创世配置，而这一步则根据配置加载或者初始化创世单元。
下图是处理流程：</p>
<p><img src="https://img.learnblockchain.cn/2019/04/07_安装创世区块.png!de" alt="安装创世区块"></p>
<p>首先，需要从数据库中根据区块高度 0 读取创世区块哈希。
如果不存在则说明本地属于第一次启动，直接使用运行时创世配置来构建创世区块。
属于首次，还需要存储创世区块和链配置。</p>
<p>如果存在，则需要使用运行时创世配置构建创世区块并和本次已存储的创世区块哈希进行对比。
一旦不一致，则返回错误，不得继续。</p>
<p>随后，还需要检查链配置。先从数据库获取链配置，如果不存在，则无需校验直接使用运行时链配置。
否则，需要检查运行时链配置是否正确，只有正确时才能替换更新。
但有一个例外：主网配置不得随意更改，由代码控制而非人为指定。</p>
<p>总的来说，以太坊默认使用主网配置，只有在首次运行时才创建和存储创世区块，其他时候仅仅用于校验。
而链配置除主网外则在规则下可随时变更。</p>
<h2><a class="anchor" aria-hidden="true" id="构建创建区块"></a><a href="#构建创建区块" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建创建区块</h2>
<p>上面我们已知晓总体流程，这里再细说下以太坊是如何根据创世配置生成创世区块。
核心代码位于 <code>core/genesis.go:229</code>。</p>
<pre><code class="hljs css language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *Genesis)</span> <span class="hljs-title">ToBlock</span><span class="hljs-params">(db ethdb.Database)</span> *<span class="hljs-title">types</span>.<span class="hljs-title">Block</span></span>{
    <span class="hljs-keyword">if</span> db == <span class="hljs-literal">nil</span> {
        db = rawdb.NewMemoryDatabase()
    }
    statedb, _ := state.New(common.Hash{}, state.NewDatabase(db))<span class="hljs-comment">//❶</span>
    <span class="hljs-keyword">for</span> addr, account := <span class="hljs-keyword">range</span> g.Alloc { <span class="hljs-comment">//❷</span>
        statedb.AddBalance(addr, account.Balance)
        statedb.SetCode(addr, account.Code)
        statedb.SetNonce(addr, account.Nonce)
        <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> account.Storage {
            statedb.SetState(addr, key, value)
        }
    }
    root := statedb.IntermediateRoot(<span class="hljs-literal">false</span>)<span class="hljs-comment">//❸</span>
    head := &amp;types.Header{<span class="hljs-comment">//❹</span>
        Number:     <span class="hljs-built_in">new</span>(big.Int).SetUint64(g.Number),
        Nonce:      types.EncodeNonce(g.Nonce),
        Time:       g.Timestamp,
        ParentHash: g.ParentHash,
        Extra:      g.ExtraData,
        GasLimit:   g.GasLimit,
        GasUsed:    g.GasUsed,
        Difficulty: g.Difficulty,
        MixDigest:  g.Mixhash,
        Coinbase:   g.Coinbase,
        Root:       root,
    }
    <span class="hljs-comment">//❺</span>
    <span class="hljs-keyword">if</span> g.GasLimit == <span class="hljs-number">0</span> {
        head.GasLimit = params.GenesisGasLimit
    }
    <span class="hljs-keyword">if</span> g.Difficulty == <span class="hljs-literal">nil</span> {
        head.Difficulty = params.GenesisDifficulty
    }

    statedb.Commit(<span class="hljs-literal">false</span>)<span class="hljs-comment">//❻</span>
    statedb.Database().TrieDB().Commit(root, <span class="hljs-literal">true</span>)<span class="hljs-comment">//❼</span>

    <span class="hljs-keyword">return</span> types.NewBlock(head, <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>)<span class="hljs-comment">//❽</span>
}
</code></pre>
<p>上面代码是根据创世配置生成创世区块的代码逻辑，细节如下：</p>
<ul>
<li><p>❶ 创世区块无父块，从零初始化全新的 <code>state</code>（后续文章会详细讲解 <code>state</code>对象）。</p></li>
<li><p>❷ 遍历配置中 <code>Alloc</code> 项账户集合数据，直接写入 state 中。
这里不单可以设置 <code>balance</code>，还可以设置 <code>code</code>、<code>nonce</code> 以及任意多个 <code>storage</code> 数据。
意味着创世时便可以直接部署智能合约。例如下面配置则在创世时部署了一个名为<code>093f59f1d91017d30d8c2caa78feb5beb0d2cfaf</code> 的智能合约。</p>
<pre><code class="hljs css language-json">"alloc": {
        "093f59f1d91017d30d8c2caa78feb5beb0d2cfaf": {
            "balance": "0xffffffffffffffff",
            "nonce": "0x3",
            "code":"0x606060",
            "storage":{
            "11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa":"1234ff"
            }
        }
}
</code></pre></li>
<li><p>❸ 将账户数据写入 state 后，便可以计算出 state 数据的默克尔树的根值，称之为 <code>StateRoot</code>。
此值记录在区块头 <code>Root</code> 字段中。</p></li>
<li><p>❹ 创世配置的一部分配置，则直接映射到区块头中，完成创世区块头的构建。</p></li>
<li><p>❺ 因为 <code>GasLimit</code> 和 <code>Difficulty</code> 直接影响到下一个区块出块处理。
因此未设置时使用默认配置(Difficulty=131072，GasLimit=4712388)。</p></li>
<li><p>❻ 提交 state，将 state 数据提交到底层的内存 trie 数据中。</p></li>
<li><p>❼ 将内存 trie 数据更新到 db 中。
这是多余的一步，因为提交到数据库是由外部进行，这里只需要负责生成区块。</p></li>
<li><p>❽ 利用区块头创建区块，且区块中无交易记录。</p></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/sipc-docs/docs/docs_4"><span class="arrow-prev">← </span><span>配置</span></a><a class="docs-next button" href="/sipc-docs/docs/docs_6"><span>账户</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#创世配置文件">创世配置文件</a><ul class="toc-headings"><li><a href="#自定义创世">自定义创世</a></li><li><a href="#内置的创世配置">内置的创世配置</a></li></ul></li><li><a href="#geth-创世区块加载流程">geth 创世区块加载流程</a><ul class="toc-headings"><li><a href="#加载创世配置">加载创世配置</a></li><li><a href="#安装创世区块">安装创世区块</a></li></ul></li><li><a href="#构建创建区块">构建创建区块</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/sipc-docs/" class="nav-home"></a><div><h5>文档</h5><a href="/sipc-docs/docs/en/doc1.html">快速开始</a><a href="/sipc-docs/docs/en/doc2.html">引导</a><a href="/sipc-docs/docs/en/doc3.html">API接口</a></div><div><h5>社区</h5><a href="/sipc-docs/en/https://t.me/SimpleChainOfficial">Telegram</a><a href="https://medium.com/@SimpleChain" target="_blank" rel="noreferrer noopener">Medium</a><a href="https://twitter.com/SimpleChain">Twitter</a><a href="https://www.linkedin.com/company/simplechain-foundation/" target="_blank" rel="noreferrer noopener">Linkedln</a></div><div><h5>更多</h5><a href="https://www.simplechain.com">官网</a><a href="https://github.com/simplechain-org">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 SimpleChain Community</section></footer></div></body></html>