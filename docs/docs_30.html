<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>子链模版 · SimpleChain开发文档</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## 部署DPOS共识子链网络"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="子链模版 · SimpleChain开发文档"/><meta property="og:type" content="website"/><meta property="og:url" content="https://simplechain.github.io/sipc-docs/"/><meta property="og:description" content="## 部署DPOS共识子链网络"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/sipc-docs/"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/sipc-docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/sipc-docs/css/main.css"/><script src="/sipc-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/sipc-docs/"><h2 class="headerTitle">SimpleChain开发文档</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_1" target="_self">文档</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_25" target="_self">API</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_50" target="_self">FAQ</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_51" target="_self">在线技术支持</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>跨链</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">快速了解</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_1">概述</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_2">快速开始</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_3">搭建节点</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">sipc和sipc代币协议</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_52">技术术语</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_4">sipc代币</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_5">在SIPC上发行代币</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">基础数据结构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_6">配置</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_7">创世块</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_8">账户</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_9">交易</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_10">区块</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_11">交易回执</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">架构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_12">SimpleChain架构设计</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_13">数据结构和存储</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_55">数据同步优化</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">底层核心技术</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_15">P2P网络</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_17">虚拟机</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_18">运行机制</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_19">异常处理</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">智能合约</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_20">智能合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_21">深入理解Solidity</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_22">合约模版</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_23">合约开发和部署</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开发者工具</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_24">搭建测试链</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_25">Sipc API</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_26">跨链API</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_27">SimPlug</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_28">sdk</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">跨链</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_53">跨链方案</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/sipc-docs/docs/docs_30">子链模版</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_54">跨链流程</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Dapp开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_31">合约编译器</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_32">编写合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_33">发布合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_34">开发流程</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">挖矿</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_35">Sipc挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_36">矿池接入</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_37">GPU挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_38">SimPool</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_39">SimpleNode x1挖矿教程</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_40">SIPC.VIP</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_41">Sipc全节点钱包</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_42">ChainBox</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_43">区块链浏览器</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">生态</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_44">交易所对接</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_45">社区项目</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_46">社区活动</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_47">社区入口</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">落地方案</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_48">落地案例</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_49">构建应用</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_50">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">技术支持</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_51">在线技术支持</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">子链模版</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="部署dpos共识子链网络"></a><a href="#部署dpos共识子链网络" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署DPOS共识子链网络</h2>
<h3><a class="anchor" aria-hidden="true" id="1-创世区块"></a><a href="#1-创世区块" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 创世区块</h3>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"config"</span>: {
    <span class="hljs-attr">"chainId"</span>: <span class="hljs-number">10388</span>,
    <span class="hljs-attr">"dpos"</span>: {
      <span class="hljs-attr">"period"</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">"epoch"</span>: <span class="hljs-number">300</span>,
      <span class="hljs-attr">"maxSignersCount"</span>: <span class="hljs-number">21</span>,
      <span class="hljs-attr">"minVoterBalance"</span>: <span class="hljs-number">100000000000000000000</span>,
      <span class="hljs-attr">"genesisTimestamp"</span>: <span class="hljs-number">1554004800</span>,
      <span class="hljs-attr">"signers"</span>: [
        <span class="hljs-string">"3d50e12fa9c76e4e517cd4ace1b36c453e6a9bcd"</span>,
        <span class="hljs-string">"f97df7fe5e064a9fe4b996141c2d9fb8a3e2b53e"</span>,
        <span class="hljs-string">"ef90068860527015097cd031bd2425cb90985a40"</span>
      ],
      <span class="hljs-attr">"pbft"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">"voterReward"</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-attr">"nonce"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"0x5ca03b40"</span>,
  <span class="hljs-attr">"extraData"</span>: <span class="hljs-string">"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"gasLimit"</span>: <span class="hljs-string">"0x47b760"</span>,
  <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"0x1"</span>,
  <span class="hljs-attr">"mixHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"coinbase"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"alloc"</span>: {
    <span class="hljs-attr">"3d50e12fa9c76e4e517cd4ace1b36c453e6a9bcd"</span>: {
      <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0x21e19e0c9bab2400000"</span>
    },
    <span class="hljs-attr">"ef90068860527015097cd031bd2425cb90985a40"</span>: {
      <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0x21e19e0c9bab2400000"</span>
    },
    <span class="hljs-attr">"f97df7fe5e064a9fe4b996141c2d9fb8a3e2b53e"</span>: {
      <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0x21e19e0c9bab2400000"</span>
    }
  },
  <span class="hljs-attr">"number"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"gasUsed"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"parentHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>
}
</code></pre>
<ul>
<li><code>period</code> dpos出块间隔时间，单位为秒</li>
<li><code>epoch</code> dpos间隔多少个块定期清除投票（清除后需要投票者重新发起投票交易)</li>
<li><code>maxSignersCount</code> dpos最大允许的生产者数量</li>
<li><code>minVoterBalance</code> dpos最小允许的投票额度，单位为Wei</li>
<li><code>voterReward</code> dpos投票者能否获得奖励（若开启，则在生产者出块时投票者也能获得分红）</li>
<li><code>genesisTimestamp</code> dpos允许初始块出块的时间，并通过此时间计算后续出块的时间与生产者</li>
<li><code>signers</code> dpos初始生产者列表</li>
<li><code>pbft</code> dpos是否在每轮出块后使用pbft的方式确认每一个区块</li>
<li><code>alloc</code> dpos初始生产者抵押投票数额</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="2-子链初始化流程"></a><a href="#2-子链初始化流程" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 子链初始化流程</h3>
<h4><a class="anchor" aria-hidden="true" id="方式一-使用sipe初始化"></a><a href="#方式一-使用sipe初始化" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式一. 使用sipe初始化</h4>
<p>1.创建或导入生产者账户</p>
<pre><code class="hljs css language-shell script">sipe --datadir=dposdata account new 
</code></pre>
<p>2.将创建或导入的生产者地址写入genesis.json中，同时写入初始投票数额（参考1.创世区块）</p>
<p>3.初始化子链节点</p>
<pre><code class="hljs css language-shell script">sipe --datadir=dposdata --role=subchain init genesis.json
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="方式二-使用consensus工具一键初始化集群"></a><a href="#方式二-使用consensus工具一键初始化集群" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式二. 使用consensus工具一键初始化集群</h4>
<p>在<code>cmd/consensus</code>目录下运行<code>init_dpos.sh</code></p>
<pre><code class="hljs css language-shell script">cd cmd/consensus
./init_dpos.sh --numNodes 3
</code></pre>
<ul>
<li><code>numNodes</code> 生成集群节点数量</li>
</ul>
<p>初始化完成后，会在<code>cmd/consensus/dposdata</code>目录下建立对应节点文件</p>
<h3><a class="anchor" aria-hidden="true" id="3-子链启动流程"></a><a href="#3-子链启动流程" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 子链启动流程</h3>
<ol>
<li>启动节点</li>
</ol>
<pre><code class="hljs css language-bash">sipe --datadir=dposdata --mine --etherbase=&lt;生产者地址&gt; --unlock=&lt;生产者地址&gt; --password=&lt;密码文件&gt; --port=30303  --role=subchain --v5disc
</code></pre>
<ol start="2">
<li>连接其他节点</li>
</ol>
<pre><code class="hljs css language-bash">sipe --datadir=dposdata --mine --etherbase=&lt;生产者地址&gt; --unlock=&lt;生产者地址&gt; --password=&lt;密码文件&gt; --port=30304  --role=subchain --v5disc --bootnodesv5={enode1} --bootnodesv4={enode1}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="4-投票与提案"></a><a href="#4-投票与提案" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. 投票与提案</h3>
<h4><a class="anchor" aria-hidden="true" id="41-发起投票交易"></a><a href="#41-发起投票交易" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.1 发起投票交易</h4>
<pre><code class="hljs css language-bash">&gt; eth.sendTransaction({from:<span class="hljs-string">"&lt;投票地址&gt;"</span>,to:<span class="hljs-string">"&lt;被投票地址&gt;"</span>,value:0,data:web3.toHex(<span class="hljs-string">"dpos:1:event:vote"</span>)})
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="42-发起取消投票交易"></a><a href="#42-发起取消投票交易" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.2 发起取消投票交易</h4>
<pre><code class="hljs css language-bash">&gt; eth.sendTransaction({from:<span class="hljs-string">"&lt;投票地址&gt;"</span>,to:<span class="hljs-string">"&lt;投票地址&gt;"</span>,value:0,data:web3.toHex(<span class="hljs-string">"dpos:1:event:devote"</span>)})
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="43-发起更改矿工奖励的提案"></a><a href="#43-发起更改矿工奖励的提案" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.3 发起更改矿工奖励的提案</h4>
<ul>
<li>将矿工区块奖励比例改为<code>666‰</code></li>
</ul>
<pre><code class="hljs css language-bash">&gt; eth.sendTransaction({from:<span class="hljs-string">"&lt;提案地址&gt;"</span>,to:<span class="hljs-string">"&lt;提案地址&gt;"</span>,value:0,data:web3.toHex(<span class="hljs-string">"dpos:1:event:proposal:proposal_type:3:mrpt:666"</span>)})
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="44-发起更改最小允许投票额度的提案"></a><a href="#44-发起更改最小允许投票额度的提案" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.4 发起更改最小允许投票额度的提案</h4>
<ul>
<li>将最小允许投票额度改为<code>10</code> ether</li>
</ul>
<pre><code class="hljs css language-bash">&gt; eth.sendTransaction({from:<span class="hljs-string">"&lt;提案地址&gt;"</span>,to:<span class="hljs-string">"&lt;提案地址&gt;"</span>,value:0,data:web3.toHex(<span class="hljs-string">"dpos:1:event:proposal:proposal_type:6:mvb:10"</span>)})
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="45-通过或反对提案"></a><a href="#45-通过或反对提案" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.5 通过或反对提案</h4>
<ul>
<li><code>yes</code>通过提案，<code>no</code>反对提案</li>
</ul>
<pre><code class="hljs css language-bash">&gt; eth.sendTransaction({from:<span class="hljs-string">"&lt;投票地址&gt;"</span>,to:<span class="hljs-string">"&lt;投票地址&gt;"</span>,value:0,data:web3.toHex(<span class="hljs-string">"dpos:1:event:declare:hash:&lt;提案hash值&gt;:decision:yes"</span>)})
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="5-查看共识状态"></a><a href="#5-查看共识状态" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. 查看共识状态</h3>
<pre><code class="hljs css language-bash">&gt; dpos.getSnapshot()
</code></pre>
<ul>
<li><code>candidates</code> 矿工候选者名单</li>
<li><code>confirmedNumber</code> 确认的区块高度</li>
<li><code>historyHash</code> 最近两轮出块的块hash，用来计算新一轮的生产者出块顺序</li>
<li><code>minerReward</code> 每个块生产者获得的奖励千分比，若开启<code>voterReward</code>，剩下的为投票者的奖励</li>
<li><code>signers</code> 列举生产者名单与出块顺序</li>
<li><code>punished</code> 列举每个生产者因未按时出块受到的惩罚信息</li>
<li><code>tally</code> 列举每个候选人的总得票数</li>
<li><code>votes</code> 列举投票信息</li>
<li><code>voters</code> 投票人发起投票的区块高度</li>
<li><code>proposals</code> 提案列表</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="部署pbft共识子链网络"></a><a href="#部署pbft共识子链网络" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署PBFT共识子链网络</h2>
<h3><a class="anchor" aria-hidden="true" id="1-创世区块-1"></a><a href="#1-创世区块-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 创世区块</h3>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"config"</span>: {
    <span class="hljs-attr">"chainId"</span>: <span class="hljs-number">10388</span>,
    <span class="hljs-attr">"istanbul"</span>: {
      <span class="hljs-attr">"epoch"</span>: <span class="hljs-number">30000</span>,
      <span class="hljs-attr">"policy"</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">"nonce"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"extraData"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000f843f83f941c46d10e91eafaac430718df3658b1a496b827bd94b67ee9395542b227c99941eb4168e3f3c6502dd8949d6510b637970085962c908c69e63e9d36a36cb480c0"</span>,
  <span class="hljs-attr">"gasLimit"</span>: <span class="hljs-string">"0xe0000000"</span>,
  <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"0x1"</span>,
  <span class="hljs-attr">"mixHash"</span>: <span class="hljs-string">"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365"</span>,
  <span class="hljs-attr">"coinbase"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"alloc"</span>: {},
  <span class="hljs-attr">"number"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"gasUsed"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"parentHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>
}
</code></pre>
<ul>
<li><code>epoch</code> pbft间隔多少个块定期清除投票</li>
<li><code>policy</code> pbft提议者轮询方式，0为roundRobin（按顺序更换），1为sticky（提议者未出错时不更换提议者）</li>
<li><code>mixHash</code> pbft区块须将mixHash指定为0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365</li>
<li><code>extraData</code> pbft初始生产者计算后得到的header.extra</li>
<li><code>alloc</code> pbft暂无区块奖励，因此需要提前分配代币</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="2-子链初始化流程-1"></a><a href="#2-子链初始化流程-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 子链初始化流程</h3>
<h4><a class="anchor" aria-hidden="true" id="方式一-使用sipe初始化-1"></a><a href="#方式一-使用sipe初始化-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式一. 使用sipe初始化</h4>
<p>1.创建或导入生产者账户</p>
<pre><code class="hljs css language-shell script">sipe --datadir=pbftdata account new 
</code></pre>
<p>2.使用consensus工具生成extraData，写入到genesis.json中（参考1.创世区块）</p>
<pre><code class="hljs css language-shell script">cd cmd/consensus
./init_pbft.sh --numNodes 1 --validator &lt;生产者地址&gt; 
</code></pre>
<p>3.初始化子链节点</p>
<pre><code class="hljs css language-shell script">sipe --datadir=pbftdata --role=subchain init genesis.json
</code></pre>
<ol start="4">
<li>将节点的nodekey写入到pbftdata/static-nodes.json中（nodekey公钥为生产者公钥）</li>
</ol>
<h4><a class="anchor" aria-hidden="true" id="方式二-使用consensus工具一键初始化集群-1"></a><a href="#方式二-使用consensus工具一键初始化集群-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式二. 使用consensus工具一键初始化集群</h4>
<p>在cmd/consensus目录下运行init_pbft.sh</p>
<pre><code class="hljs css language-bash"> <span class="hljs-built_in">cd</span> cmd/consensus
 ./init_pbft.sh --numNodes 3 --ip 127.0.0.1 127.0.0.2 127.0.0.3 --port 21001 21002 21003
</code></pre>
<ul>
<li><code>numNodes</code> 生成集群节点数量</li>
<li><code>ip</code> 指定节点的ip列表（默认ip为127.0.0.1）</li>
<li><code>port</code> 指定节点的端口列表（默认端口为21001~2100x，x为numNodes）</li>
</ul>
<p>初始化完成后，会在<code>cmd/consensus/pbftdata</code>目录下建立对应节点文件</p>
<h3><a class="anchor" aria-hidden="true" id="3-子链启动流程-1"></a><a href="#3-子链启动流程-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 子链启动流程</h3>
<pre><code class="hljs css language-bash">sipe --datadir=pbftdata --istanbul.requesttimeout=10000 --istanbul.blockperiod=5 --syncmode=full --mine --minerthreads=1 --port=21001 --role=subchain
</code></pre>
<ul>
<li><code>port</code> 需要和static-nodes.json中配置的enode保持一致</li>
<li><code>istanbul.requesttimeout</code> pbft每个view的过期时间，单位毫秒，默认值为10000</li>
<li><code>istanbul.blockperiod</code> pbft出块间隔，单位秒，默认值为1</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="4查看共识状态"></a><a href="#4查看共识状态" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.查看共识状态</h3>
<pre><code class="hljs css language-shell script"><span class="hljs-meta">&gt;</span><span class="bash"> istanbul.getSnapshot()</span>
</code></pre>
<ul>
<li><code>validators</code> pbft区块生产者名单</li>
<li><code>votes</code> 新增validator或移除validator的投票</li>
<li><code>tally</code> 总投票情况</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="部署raft共识子链网络"></a><a href="#部署raft共识子链网络" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>部署RAFT共识子链网络</h2>
<h3><a class="anchor" aria-hidden="true" id="1-创世区块-2"></a><a href="#1-创世区块-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 创世区块</h3>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"config"</span>: {
    <span class="hljs-attr">"chainId"</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">"raft"</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">"nonce"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"extraData"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"gasLimit"</span>: <span class="hljs-string">"0xe0000000"</span>,
  <span class="hljs-attr">"difficulty"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"mixHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"coinbase"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000"</span>,
  <span class="hljs-attr">"alloc"</span>: {
    <span class="hljs-attr">"1e69ebb349e802e25c7eb3b41adb6d18a4ae8591"</span>: {
      <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0x21e19e0c9bab2400000"</span>
    },
    <span class="hljs-attr">"73ce1d55593827ab5a680e750e347bf57485a511"</span>: {
      <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0x21e19e0c9bab2400000"</span>
    },
    <span class="hljs-attr">"b8564a5657fa7dc51605b58f271b5bafad93b984"</span>: {
      <span class="hljs-attr">"balance"</span>: <span class="hljs-string">"0x21e19e0c9bab2400000"</span>
    }
  },
  <span class="hljs-attr">"number"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"gasUsed"</span>: <span class="hljs-string">"0x0"</span>,
  <span class="hljs-attr">"parentHash"</span>: <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>
}
</code></pre>
<ul>
<li><code>raft</code> true为使用raft共识</li>
<li><code>alloc</code> raft共识只有存在交易的时候才打包区块，因此需要提前分配代币</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="2-子链初始化流程-2"></a><a href="#2-子链初始化流程-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 子链初始化流程</h3>
<h4><a class="anchor" aria-hidden="true" id="方式一-使用sipe初始化-2"></a><a href="#方式一-使用sipe初始化-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式一. 使用sipe初始化</h4>
<p>1.创建或导入生产者账户</p>
<pre><code class="hljs css language-bash">sipe --datadir=raftdata account new 
</code></pre>
<p>2.初始化子链节点</p>
<pre><code class="hljs css language-bash">sipe --datadir=raftdata --role=subchain init genesis.json
</code></pre>
<p>4.将节点的<code>nodekey</code>写入<code>raftdata/static-nodes.json</code>中（nodekey公钥为生产者公钥）</p>
<h4><a class="anchor" aria-hidden="true" id="方式二-使用consensus工具一键初始化集群-2"></a><a href="#方式二-使用consensus工具一键初始化集群-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式二. 使用consensus工具一键初始化集群</h4>
<p>在<code>cmd/consensu</code>s目录下运行<code>init_pbft.sh</code></p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> cmd/consensus
./init_raft.sh --numNodes 3 --ip 127.0.0.1 127.0.0.2 127.0.0.3 --port 21001 21002 21003 --raftport 50401 50402 50403
</code></pre>
<ul>
<li><code>numNodes</code> 生成集群节点数量</li>
<li><code>ip</code> 指定节点的ip列表（默认ip为127.0.0.1）</li>
<li><code>port</code> 指定节点的端口列表（默认端口为21001~2100x，x为numNodes）</li>
<li><code>raftport</code> 指定节点的raft通信端口列表（默认端口为50401~5040x，x为numNodes）
初始化完成后，会在cmd/consensus/raftdata目录下建立对应节点文件</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="3-子链启动流程-2"></a><a href="#3-子链启动流程-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 子链启动流程</h3>
<pre><code class="hljs css language-bash">sipe --datadir=raftdata --raft --port=21001 --raftport=50401 --role=subchain
</code></pre>
<ul>
<li><code>port</code> 需要和static-nodes.json中配置的enode保持一致</li>
<li><code>raft</code> 使用raft模式</li>
<li><code>raftport</code> raft端口号，需要和static-nodes.json中配置的enode保持一致</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="4查看共识状态-1"></a><a href="#4查看共识状态-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.查看共识状态</h3>
<pre><code class="hljs css language-bash">&gt; istanbul.getSnapshot()
</code></pre>
<ul>
<li><code>validators</code> pbft区块生产者名单</li>
<li><code>votes</code> 新增validator或移除validator的投票</li>
<li><code>tally</code> 总投票情况</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/sipc-docs/docs/docs_53"><span class="arrow-prev">← </span><span>跨链方案</span></a><a class="docs-next button" href="/sipc-docs/docs/docs_54"><span>跨链流程</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#部署dpos共识子链网络">部署DPOS共识子链网络</a><ul class="toc-headings"><li><a href="#1-创世区块">1. 创世区块</a></li><li><a href="#2-子链初始化流程">2. 子链初始化流程</a></li><li><a href="#3-子链启动流程">3. 子链启动流程</a></li><li><a href="#4-投票与提案">4. 投票与提案</a></li><li><a href="#5-查看共识状态">5. 查看共识状态</a></li></ul></li><li><a href="#部署pbft共识子链网络">部署PBFT共识子链网络</a><ul class="toc-headings"><li><a href="#1-创世区块-1">1. 创世区块</a></li><li><a href="#2-子链初始化流程-1">2. 子链初始化流程</a></li><li><a href="#3-子链启动流程-1">3. 子链启动流程</a></li><li><a href="#4查看共识状态">4.查看共识状态</a></li></ul></li><li><a href="#部署raft共识子链网络">部署RAFT共识子链网络</a><ul class="toc-headings"><li><a href="#1-创世区块-2">1. 创世区块</a></li><li><a href="#2-子链初始化流程-2">2. 子链初始化流程</a></li><li><a href="#3-子链启动流程-2">3. 子链启动流程</a></li><li><a href="#4查看共识状态-1">4.查看共识状态</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/sipc-docs/" class="nav-home"></a><div><h5>文档</h5><a href="/sipc-docs/docs/en/doc1.html">快速开始</a><a href="/sipc-docs/docs/en/doc2.html">引导</a><a href="/sipc-docs/docs/en/doc3.html">API接口</a></div><div><h5>社区</h5><a href="/sipc-docs/en/https://t.me/SimpleChainOfficial">Telegram</a><a href="https://medium.com/@SimpleChain" target="_blank" rel="noreferrer noopener">Medium</a><a href="https://twitter.com/SimpleChain">Twitter</a><a href="https://www.linkedin.com/company/simplechain-foundation/" target="_blank" rel="noreferrer noopener">Linkedln</a></div><div><h5>更多</h5><a href="https://www.simplechain.com">官网</a><a href="https://github.com/simplechain-org">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 SimpleChain Community</section></footer></div></body></html>