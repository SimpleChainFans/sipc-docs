<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>创世块 · SimpleChain开发文档</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="创世区块作为第零个区块，其他区块直接或间接引用到创世区块。"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="创世块 · SimpleChain开发文档"/><meta property="og:type" content="website"/><meta property="og:url" content="https://simplechain.github.io/sipc-docs/"/><meta property="og:description" content="创世区块作为第零个区块，其他区块直接或间接引用到创世区块。"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/sipc-docs/"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/sipc-docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/sipc-docs/css/main.css"/><script src="/sipc-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/sipc-docs/"><h2 class="headerTitle">SimpleChain开发文档</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_1" target="_self">文档</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_25" target="_self">API</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_50" target="_self">FAQ</a></li><li class="siteNavGroupActive"><a href="/sipc-docs/docs/docs_51" target="_self">在线技术支持</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>基础数据结构</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">快速了解</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_1">概述</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_2">快速开始</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_3">搭建节点</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">sipc和sipc代币协议</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_52">技术术语</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_4">sipc代币</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_5">在SIPC上发行代币</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">基础数据结构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_6">配置</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/sipc-docs/docs/docs_7">创世块</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_8">账户</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_9">交易</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_10">区块</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_11">交易回执</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">架构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_12">架构设计</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_13">MPT</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">底层核心技术</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_14">共识算法</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_15">P2P网络</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_16">交易存储</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">虚拟机</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_17">虚拟机</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_18">运行机制</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_19">异常处理</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">智能合约</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_20">智能合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_22">合约模版</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_23">合约开发和部署</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开发者工具</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_24">搭建测试链</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_25">Sipc API</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_26">跨链API</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_27">js_sdk</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_28">java_sdk</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_29">python_sdk</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_30">子链模版</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Dapp开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_31">合约编译器</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_32">编写合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_33">发布合约</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_34">开发流程</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">挖矿</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_35">Sipc挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_36">矿池接入</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_37">GPU挖矿</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_38">SimPool</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_39">SimpleNode x1挖矿教程</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_40">SIPC.VIP</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_41">Sipc全节点钱包</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_42">ChainBox</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_43">区块链浏览器</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">生态</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_44">交易所对接</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_45">社区项目</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_46">社区活动</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_47">社区入口</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">落地方案</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_48">落地案例</a></li><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_49">构建应用</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_50">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">技术支持</h3><ul class=""><li class="navListItem"><a class="navItem" href="/sipc-docs/docs/docs_51">在线技术支持</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">创世块</h1></header><article><div><span><p>创世区块作为第零个区块，其他区块直接或间接引用到创世区块。
因此节点启动之初必须载入正确的创世区块信息，且不得任意修改。</p>
<p><a href="https://www.simplechain.com/">SimpleChain</a>允许通过创世配置文件来初始化创世区块，也可使用选择使用内置的多个网络环境的创世配置。
默认使用<a href="https://www.simplechain.com/">SimpleChain</a>主网创世配置。</p>
<h2><a class="anchor" aria-hidden="true" id="创世配置文件"></a><a href="#创世配置文件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创世配置文件</h2>
<p>如果你需要搭建<a href="https://www.simplechain.com/">SimpleChain</a>私有链，那么了解创世配置是必须的，否则你大可不关心创世配置。</p>
<p>下面是一份 JSON 格式的创世配置示例：</p>
<pre><code class="hljs css language-json">     {
       <span class="hljs-attr">"config"</span>: {
          <span class="hljs-attr">"chainId"</span>: <span class="hljs-number">100</span>, 
          <span class="hljs-attr">"homesteadBlock"</span>: <span class="hljs-number">0</span>, 
          <span class="hljs-attr">"eip155Block"</span>: <span class="hljs-number">0</span>, 
          <span class="hljs-attr">"eip158Block"</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-attr">"alloc"</span> : {},
      <span class="hljs-attr">"coinbase"</span> : <span class="hljs-string">"0x0000000000000000000000000000000000000000"</span>,
      <span class="hljs-attr">"difficulty"</span> : <span class="hljs-string">"0x20000"</span>,
      <span class="hljs-attr">"extraData"</span> : <span class="hljs-string">""</span>,
      <span class="hljs-attr">"gasLimit"</span> : <span class="hljs-string">"0x2fefd8"</span>,
      <span class="hljs-attr">"nonce"</span> : <span class="hljs-string">"0x0000000000000042"</span>,
      <span class="hljs-attr">"mixhash"</span> : <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>, <span class="hljs-attr">"parentHash"</span> : <span class="hljs-string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>, <span class="hljs-attr">"timestamp"</span> : <span class="hljs-string">"0x00"</span>
      }
</code></pre>
<p>根据配置用途可分为三大类：</p>
<ol>
<li>链配置</li>
</ol>
<ul>
<li><code>config</code>项是定义链配置，会影响共识协议，虽然链配置对创世影响不大，但新区块的出块规则均依赖链配置。</li>
</ul>
<ol start="2">
<li>创世区块头信息配置</li>
</ol>
<ul>
<li><code>nonce</code>：随机数，对应创世区块 <code>Nonce</code> 字段。</li>
<li><code>timestamp</code>：UTC时间戳，对应创世区块 <code>Time</code>字段。</li>
<li><code>extraData</code>：额外数据，对应创世区块 <code>Extra</code> 字段。</li>
<li><code>gasLimit</code>：<strong>必填</strong>，燃料上限，对应创世区块 <code>GasLimit</code> 字段。</li>
<li><code>difficulty</code>：<strong>必填</strong>，难度系数，对应创世区块 <code>Difficulty</code> 字段。搭建私有链时，需要根据情况选择合适的难度值，以便调整出块。</li>
<li><code>mixHash</code>：一个哈希值，对应创世区块的<code>MixDigest</code>字段。和 nonce 值一起证明在区块上已经进行了足够的计算。</li>
<li><code>coinbase</code>：一个地址，对应创世区块的<code>Coinbase</code>字段。</li>
</ul>
<ol start="3">
<li>初始账户资产配置</li>
</ol>
<ul>
<li><code>alloc</code> 项是创世中初始账户资产配置。在生成创世区块时，将此数据集中的账户资产写入区块中，相当于预挖矿。
这对开发测试和私有链非常好用，不需要挖矿就可以直接为任意多个账户分配资产。</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="simplechain创世区块加载流程"></a><a href="#simplechain创世区块加载流程" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Simplechain创世区块加载流程</h2>
<p>在运行 Simplechain 时需根据配置文件加载创世配置以及创世区块，并校验其合法性。
如果配置信息随意变更，易引起共识校验不通过等问题。
只有在加载并检查通过时，才能继续运行程序。</p>
<p><img src="https://i.loli.net/2020/05/09/XTOu5W4DsdNvoCU.png" alt="创世加载流程"></p>
<p>上图是一个简要流程，下面分别讲解“加载创世配置”和“安装创世区块”两个子流程。</p>
<h3><a class="anchor" aria-hidden="true" id="加载创世配置"></a><a href="#加载创世配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加载创世配置</h3>
<p>应使用哪种创世配置，由用户在启动 geth 时决定。下图是创世配置选择流程图：</p>
<p><img src="https://img.learnblockchain.cn/2019/04/07_WX20190407-103229@2x.png!de" alt="Simplechain创世配置选择流程图"></p>
<p>通过 geth 命令参数可选择不同网络配置，可以通过 <code>networkid</code> 选择，也可使用网络名称启用。</p>
<ol>
<li><p>使用 networkid:</p>
<p>不同网络使用不同ID标识。</p>
<ul>
<li>1=Frontier，主网环境，是默认选项。</li>
<li>2=Morden 测试网络，但已禁用。</li>
<li>3=Ropsten 测试网络。</li>
<li>4=Rinkeby 测试网络。</li>
</ul></li>
<li><p>直接使用网络名称：</p>
<ul>
<li>testnet: Ropsten 测试网络。</li>
<li>rinkeby: Rinkeby 测试网络。</li>
<li>goerli: Görli 测试网络。</li>
<li>dev: 本地开发环境。</li>
</ul></li>
</ol>
<p>geth 启动时根据不同参数选择加载不同网络配置，并对应不同网络环境。
如果不做任何选择，虽然在此不会做出选择，但在后面流程中会默认使用主网配置。</p>
<h3><a class="anchor" aria-hidden="true" id="安装创世区块"></a><a href="#安装创世区块" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装创世区块</h3>
<p>上面已初步选择创世配置，而这一步则根据配置加载或者初始化创世单元。
下图是处理流程：</p>
<p><img src="https://img.learnblockchain.cn/2019/04/07_安装创世区块.png!de" alt="安装创世区块"></p>
<p>首先，需要从数据库中根据区块高度 0 读取创世区块哈希。
如果不存在则说明本地属于第一次启动，直接使用运行时创世配置来构建创世区块。
属于首次，还需要存储创世区块和链配置。</p>
<p>如果存在，则需要使用运行时创世配置构建创世区块并和本次已存储的创世区块哈希进行对比。
一旦不一致，则返回错误，不得继续。</p>
<p>随后，还需要检查链配置。先从数据库获取链配置，如果不存在，则无需校验直接使用运行时链配置。
否则，需要检查运行时链配置是否正确，只有正确时才能替换更新。
但有一个例外：主网配置不得随意更改，由代码控制而非人为指定。</p>
<p>总的来说，Simplechain默认使用主网配置，只有在首次运行时才创建和存储创世区块，其他时候仅仅用于校验。
而链配置除主网外则在规则下可随时变更。</p>
<h2><a class="anchor" aria-hidden="true" id="构建创建区块"></a><a href="#构建创建区块" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构建创建区块</h2>
<p>上面我们已知晓总体流程，这里再细说下Simplechain是如何根据创世配置生成创世区块。
核心代码位于 <code>core/genesis.go:229</code></p>
<pre><code class="hljs css language-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g *Genesis)</span> <span class="hljs-title">ToBlock</span><span class="hljs-params">(db ethdb.Database)</span> *<span class="hljs-title">types</span>.<span class="hljs-title">Block</span></span>{
    <span class="hljs-keyword">if</span> db == <span class="hljs-literal">nil</span> {
        db = rawdb.NewMemoryDatabase()
    }
    statedb, _ := state.New(common.Hash{}, state.NewDatabase(db))<span class="hljs-comment">//❶</span>
    <span class="hljs-keyword">for</span> addr, account := <span class="hljs-keyword">range</span> g.Alloc { <span class="hljs-comment">//❷</span>
        statedb.AddBalance(addr, account.Balance)
        statedb.SetCode(addr, account.Code)
        statedb.SetNonce(addr, account.Nonce)
        <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> account.Storage {
            statedb.SetState(addr, key, value)
        }
    }
    root := statedb.IntermediateRoot(<span class="hljs-literal">false</span>)<span class="hljs-comment">//❸</span>
    head := &amp;types.Header{<span class="hljs-comment">//❹</span>
        Number:     <span class="hljs-built_in">new</span>(big.Int).SetUint64(g.Number),
        Nonce:      types.EncodeNonce(g.Nonce),
        Time:       g.Timestamp,
        ParentHash: g.ParentHash,
        Extra:      g.ExtraData,
        GasLimit:   g.GasLimit,
        GasUsed:    g.GasUsed,
        Difficulty: g.Difficulty,
        MixDigest:  g.Mixhash,
        Coinbase:   g.Coinbase,
        Root:       root,
    }
    <span class="hljs-comment">//❺</span>
    <span class="hljs-keyword">if</span> g.GasLimit == <span class="hljs-number">0</span> {
        head.GasLimit = params.GenesisGasLimit
    }
    <span class="hljs-keyword">if</span> g.Difficulty == <span class="hljs-literal">nil</span> {
        head.Difficulty = params.GenesisDifficulty
    }

    statedb.Commit(<span class="hljs-literal">false</span>)<span class="hljs-comment">//❻</span>
    statedb.Database().TrieDB().Commit(root, <span class="hljs-literal">true</span>)<span class="hljs-comment">//❼</span>

    <span class="hljs-keyword">return</span> types.NewBlock(head, <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>)<span class="hljs-comment">//❽</span>
}
</code></pre>
<p>上面代码是根据创世配置生成创世区块的代码逻辑，细节如下：</p>
<ul>
<li><p>❶ 创世区块无父块，从零初始化全新的 <code>state</code>（后续文章会详细讲解 <code>state</code>对象）。</p></li>
<li><p>❷ 遍历配置中 <code>Alloc</code> 项账户集合数据，直接写入 state 中。
这里不单可以设置 <code>balance</code>，还可以设置 <code>code</code>、<code>nonce</code> 以及任意多个 <code>storage</code> 数据。
意味着创世时便可以直接部署智能合约。例如下面配置则在创世时部署了一个名为<code>093f59f1d91017d30d8c2caa78feb5beb0d2cfaf</code> 的智能合约。</p>
<pre><code class="hljs css language-json">"alloc": {
        "093f59f1d91017d30d8c2caa78feb5beb0d2cfaf": {
            "balance": "0xffffffffffffffff",
            "nonce": "0x3",
            "code":"0x606060",
            "storage":{
            "11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa":"1234ff"
            }
        }
}
</code></pre></li>
<li><p>❸ 将账户数据写入 state 后，便可以计算出 state 数据的默克尔树的根值，称之为 <code>StateRoot</code>。
此值记录在区块头 <code>Root</code> 字段中。</p></li>
<li><p>❹ 创世配置的一部分配置，则直接映射到区块头中，完成创世区块头的构建。</p></li>
<li><p>❺ 因为 <code>GasLimit</code> 和 <code>Difficulty</code> 直接影响到下一个区块出块处理。
因此未设置时使用默认配置(Difficulty=131072，GasLimit=4712388)。</p></li>
<li><p>❻ 提交 state，将 state 数据提交到底层的内存 trie 数据中。</p></li>
<li><p>❼ 将内存 trie 数据更新到 db 中。
这是多余的一步，因为提交到数据库是由外部进行，这里只需要负责生成区块。</p></li>
<li><p>❽ 利用区块头创建区块，且区块中无交易记录。</p></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/sipc-docs/docs/docs_6"><span class="arrow-prev">← </span><span>配置</span></a><a class="docs-next button" href="/sipc-docs/docs/docs_8"><span>账户</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#创世配置文件">创世配置文件</a></li><li><a href="#simplechain创世区块加载流程">Simplechain创世区块加载流程</a><ul class="toc-headings"><li><a href="#加载创世配置">加载创世配置</a></li><li><a href="#安装创世区块">安装创世区块</a></li></ul></li><li><a href="#构建创建区块">构建创建区块</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/sipc-docs/" class="nav-home"></a><div><h5>文档</h5><a href="/sipc-docs/docs/en/doc1.html">快速开始</a><a href="/sipc-docs/docs/en/doc2.html">引导</a><a href="/sipc-docs/docs/en/doc3.html">API接口</a></div><div><h5>社区</h5><a href="/sipc-docs/en/https://t.me/SimpleChainOfficial">Telegram</a><a href="https://medium.com/@SimpleChain" target="_blank" rel="noreferrer noopener">Medium</a><a href="https://twitter.com/SimpleChain">Twitter</a><a href="https://www.linkedin.com/company/simplechain-foundation/" target="_blank" rel="noreferrer noopener">Linkedln</a></div><div><h5>更多</h5><a href="https://www.simplechain.com">官网</a><a href="https://github.com/simplechain-org">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 SimpleChain Community</section></footer></div></body></html>